# Ибрагимова Алина Александровна, БПИ226, ИДЗ4. Вариант 5.
## Условие:
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/c4e68ca4-50d1-4c81-9e29-492357752829)
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/13b49712-5171-4988-bc14-ecd3a978ed5f)

## Как я поняла условие:
Есть база данных. Есть N потоков-читателей. Есть K потоков-писателей. 

Читатели: просматривают случайные записи базы (+ вывод номер-индекс-значение).

Писатели: выбирают случаную запись, случайно сменяют у неё значение (+ вывод номер-индекс-старое-новое_значение). 

БД: некая структура, каждый элемент которой содержит индекс и значение. При добавлении сразу же сортируется (по какому критерию?), могут индексы записей поменяться.

Доступы к БД: райтер имеет исключительный доступ к БД. Ридер может использовать БД, только если к нему не обращается ни один из писателей. Несколько ридеров одновременно могут использовать БД.

## Структура загруженного решения:
Претендую на 6-7.

В папке 4-5 содержатся данные (программа avs_4_threads и тесты tests), необходимые на 4-5 баллов.

В папке 6-7 программный проект на 6-7 баллов.

Отчёт общий для всех оценок.

## Предупреждение:
Читатели = ридеры.
Писатели = райтеры.

Иногда называю так, иногда по второму варианту. Первый как из задания, а второй как в коде их назвала, поэтому прыгаю по названиям.

# Критерии на 4-5:
## 1. Соблюдены общие требования к отчету
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/6d9ff87a-688e-40ea-a75e-db7b266e92db)
1-3 пункты в шапке отчёта.

4-5 пункты: так как в программе на 4-5 из данных, которые мы можем предоставить, только количество потоков райтеров и ридеров, то тесты будут ручные, и значения из тестовых файлов надо будет вставлять в консоль. В папке 4-5 есть папка tests. Там три теста:

1) количество потоков райтеров и ридеров примерно равно;
2) ридеров сильно больше, чем райтеров;
3) райтеров сильно больше, чем ридеров;

   На консоли это выглядит вот так (т.к. это потоки, то каждый раз вывод будет разным + у меня программа не имеет специального логического конца, поэтому она работает ровно до момента, пока её вручную не прервать, так что в тестах и на скринах далеко не полный output) - просто примеры:
   ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/2b034cc4-3325-454c-88d7-2b422021e845)
   ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/923a60b1-4328-41ca-9528-dba2e98efad3)
   ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/ac3676a9-4d5d-4314-b994-19bc02beee56)

6 пункт: текст программы на 4-5 хранится в папке 4-5 (см. пункт "Структура загруженного решения").

7 пункт: мяу.

## 2. Сценарий
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/069290ea-141b-4759-8a86-bdfe577bd1a4)
(Програмнная реализация и подробное описание прослеживается в комментариях кода - почти каждая строчка закомментирована)

Краткий сценарий: 
1. Создаётся БД.
2. Создаются потоки.
3. Потоки пакостят в БД, выводя это на экран.

Сценарий-алгоритм подробный (сущности: пользователь, читатель, писатель, датабаза):
0. Инициализируется датабаза.
1. Ввод количества ридеров пользователем.
2. Ввод количества райтеров пользователем.
3. Создание "яслей" для потоков, где их хранить.
4. Заполнение яслей рождающимися потоками ридеров, дальше райтеров.
5. Запускаются потоки читателей: захватывают датабазу, смотрят значение рандомного элемента, проверка счётчика, если равен текущему идетификатору, продолжает пакостить, иначе блокируется и ожидает сигнала; выводит информацию на консоль, проверяет счётчик, отпускает БД и начинает следующий.
6. Потом запускается каждый поток писатель - тут они уже не могут работать параллельно, каждый захватывает БД только для себя любимого: пауза, эксклюзивно захватывает БД, меняет значение в базе, , выводит в консоль, заканчивает экслюзивный доступ к БД.
7. Всё взаимодейтсвие межзду потоками двух типов и между собой совершается через мьютекс, условную переменную, рвлок и счётчик читателей.

## Модель параллельных вычислений:
Портфель задач, где разделяемая переменная - БД.

## Входные данные:
Целое положительное число. (инт)

Целое положительное число. (инт)

## Другие критерии:
Консольное приложение реализовано.

Ввод с консоли.

Генераторы реализованы, их даипазоны рассчитываются через модули от деления, все данные подписаны в комментариях кода.

Вывод информативен и отражает происходящее.

Комменатрии в программе есть.

Примеры результатов работы программы есть в качестве скриншотов.

# На 6-7
## Обощённый алгоритм:
Он был подробно описан в позапрошлом пункте, назывался "Сценарий-алгоритм подробный".

## Генерация в диапазонах:
С помощью rand() мы генерируем число в диапазоне от 0 до MAX_SIZE. Чтобы скорректировать необходимые нам диапазоны, используем % и +. Разберём на примере.

rand() % db_size -> получаем индексы только в пределах индексов датабазы;
rand() % 100 -> от 0 до 99
rand() % 4 + 3 -> от 3 до 6

## Ввод из командной строки:
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/d9fe1aa4-b1f9-44a0-b000-ba4a01dc1cbf)

Это ввод из терминала, осуществлённый в коде.

Теперь рассмотрим запуск.

![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/206eaaab-efe1-45e6-b722-827efd81555c)

На скрине видно, как программа запускается через терминал: сначала путь к файлу, потом аргументы.

Таким образом, в int main(int argc, char* argv[]) argc - количество аргументов (в нашем случае 3: имя и два числа), а argv - массив входных данных с терминала, где argv[0] - имя файла, argv[1] и argv[2] - числа.
   
# На 8
## В отличие от программы на 6-7, программа на 8...:
В программе на 8 в отличие от программы на 6-7 такие изменения:
1. добавлена библиотека для создания потоков с файлами
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/e3fc2825-38b7-499b-b90f-eda3bf821693)
2. глобально инициализируются потоки на чтение из файла и запись в файл
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/d6da0c77-5dbd-4ffd-94a0-10360a33e1a0)
3. везде, где вывод информации на консоль, добавлено вывод информации в файл
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/5a9b047a-733e-4423-b36a-5348a0519147)
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/c1e78977-5349-4724-8b63-46f098d15b51)
4. в мейне считывается количество аргументов при вызове из терминала - если аргументов 3, то это имя проекта, путь файла с данными и путь файла для записи. если аргумента 4, то это имя проекта, инт_1, инт_2 и путь файла для записи. это обратаывается в if и далее отттуда вытаскивается инфа о интересующих нас числах.
![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/d0be14b9-804f-41b3-a199-e18eecea2aef)

Пробежимся по критериям:
1. вывод в файл - добавлено.
2. результаты и на консоль, и в файл - выполнено (см. дальше тесты и скрины тестов).
3. выбор, вводить ли данные с из файла или терминала есть - все подробные условия этого дейтсвия предусмотрены.
4. ввод данных из командной строки расширен с учётом введённых изменений - да.
5. резкльаты отражены в отчёте - да.
6. не менее 3 вариантов входных и выходных файлов с тестами - сейчас будет ниже.

## Тесты программы на 8 баллов:
Повторюсь, что мои потоки бесконечно могут работать, так что в аутпут не располагается вся информация, что есть в консоли или файле - это только часть вывода.

1. вводим неверное число аргументов в терминале (этих вариантов не будет в папке с тестовыми файлами, т.к. в таком случае сообщение возвращается только на консоль):
   1) один аргумент:
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/11fb640b-f4ff-4bd2-99b8-2c68cee0033a)
   2) слишком много аргументов:
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/35a3f72e-6570-4ae9-83eb-d7ac402b1938)

2. ввод числа + путь файла для записи (тестовые файлы в папке 8\tests_8):
   1) input_1/output_1 (терминал + консоль + файл для вывода):
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/6b6de04b-2693-41fb-b791-787ddf3b8262)
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/b8f0d232-0580-4735-9604-58071811f3b1)
   2) input_2/output_2 (терминал + консоль + файл для вывода) - обратим внимание, что содержимое файла с прошлого раза перезаписывается и там не остаётся данных с прошлых запусков:
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/742e2061-7b0f-4f78-99b3-38ffb86d6800)
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/10e40a11-d7bc-4e04-b998-8a70d92a939b)

3. ввод пути с инфой + путь файла для записи (тестовые файлы в папке 8\tests_8):
   1) input_3/output_3 (терминал + консоль + файл с инфой + файл для вывода):
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/cde0ca5a-cbae-4c86-a8bc-9ebc7e6a300e)
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/cd24ac1a-17db-4515-9538-b7dae1c39b62)
      ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/09bf07f0-4a28-43aa-9bbb-d569aea2528a)

   2) input_4/output_4 (терминал + консоль + файл с инфой + файл для вывода):
   ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/5afb6956-57c5-4628-9ab5-3c98859e91db)
   ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/9da5920b-54fc-49d3-aa48-950df392855b)
   ![изображение](https://github.com/AlinaMalinafff/AVS/assets/150148650/ba74b748-c883-405d-b848-48c01af203fa)

Спасибо за внимание! С наступающим!!!

![9a980d27c113901f827800bbef2999c8](https://github.com/AlinaMalinafff/AVS/assets/150148650/ed03f4c1-98ea-4db2-8e51-b898880c1535)










